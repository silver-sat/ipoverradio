# ipoverserial
Demonstration code / configuration for setting up a raspberry pi internet connection over a serial link to another (internet connected) raspberry pi. Tested on two Raspbery Pi Zero W running rapberian buster. 

## Preamble
Get things up and running so both devices can be accessed on the command-line from a single laptop.
1. Get each raspbery pi running and configured by connecting a keyboard, mouse, and monitor as needed.
2. Run raspi-config and ensure that ssh, i2c, spi, and hardware serial are on, and that the login shell is not accessible over the serial interface. 
3. Set up each raspberry pi to automatically connect to a convenient WiFi network by editing `/etc/wpa_supplicant/wpa_supplicant.conf` to provide SSID and password - append the following at the end of file. 
```
    network={
        ssid="<SSID>"
        psk="<PASSWORD>"
    }
```
4. Set the WiFi router to provide consistent predictable IP addresses for each raspberry pi (after initial connection you'll usually be able to see each pi's MAC address). I used 10.0.0.101 and 10.0.0.102. 
5. Reboot the raspbery pis so they get assigned their assigned IP addresses. 
6. Download the [PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html) ssh client and check you can connect to each pi at their IP address, using the username pi, and the password set in step 1 or 2. 

## Instructions
1. If not already done, run raspi-config and ensure that hardward serial is on, and the login shell is not accessible over the serial interface.
2. RPi-A (10.0.0.101) will be the bridge to the internet for RPi-B (10.0.0.102 over WiFi).
3. Connect wires from RPi-A GPIO GND to RPi-B GPIO GND; RPi-A GPIO TX to RPi-B GPIO RX; and RPi-A GPIO RX to RPi-B GPIO TX. 
4. On both RPi-A and RPi-B, add the following to the end of `/etc/rc.local` before `exit 0`. This will ensure that wifi is turned on at startup (helpful if something doesn't work right for RPi-B and wifi gets turned off) and execute the script `/home/pi/.startup.sh`, if `/home/pi/.startup.sh` is present and executable. Any output generated by the script is logged to `/home/pi/.startup.log`. See file `rc.local.insert.sh` in the current folder.
```bash
rfkill unblock wifi
if [ -x /home/pi/.startup.sh ]; then
    /home/pi/.startup.sh >/home/pi/.startup.log 2>&1 &
fi
```
5. On both RPi-A and RPi-B, add the following to the end of `/etc/ax25/axports`. See file `axports` in the current folder.
```
serial  MYCALL          19200   484     5       Serial interface
```
6. On both RPi-A and RPi-B, ensure the axtools are installed
```
% apt install ax25-apps ax25-tools
```
7. On RPi-A download the `bridge_startup.sh` file to `/home/pi`. 
8. On RPi-B download the `satellite_startup.sh` file to `home/pi`.
